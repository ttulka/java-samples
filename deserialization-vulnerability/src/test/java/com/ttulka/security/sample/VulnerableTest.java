package com.ttulka.security.sample;

import java.io.Serializable;
import java.nio.file.Path;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.io.TempDir;

import static com.ttulka.security.SerializationUtils.deserialize;
import static com.ttulka.security.SerializationUtils.serialize;
import static org.assertj.core.api.Assertions.assertThat;

class VulnerableTest {

    @Test
    void object_is_serialized(@TempDir Path tempDir) throws Exception {
        Vulnerable vulnerable = new Vulnerable();
        vulnerable.setObject(new MyItem("Test123"));
        vulnerable.setProperty("myProp");

        Path serFile = tempDir.resolve("test.ser");

        serialize(vulnerable, serFile);

        Vulnerable deserialized = deserialize(serFile);

        assertThat(deserialized.toString()).isEqualTo("Test123");
    }

    static class MyItem implements Serializable {

        private static final long serialVersionUID = 1L;

        private final Object prop;

        MyItem(Object prop) {
            this.prop = prop;
        }

        public Object getMyProp() {
            return prop;
        }
    }
}
