package com.ttulka.security;

import java.nio.file.Path;

import com.ttulka.security.sample.Vunerable;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.io.TempDir;

import static com.ttulka.security.SerializationUtils.deserialize;
import static com.ttulka.security.SerializationUtils.serialize;
import static org.assertj.core.api.Assertions.assertThat;

class ExploitTest {

    @Test
    void exploit_is_executed(@TempDir Path tempDir) throws Exception {
        Path hackedFile = tempDir.resolve("_YOU_HAVE_BEEN_HACKED_");

        Vunerable vunerable = new Vunerable();
        vunerable.setProperty(new Exploit("touch " + hackedFile.toAbsolutePath()));

        Path serFile = tempDir.resolve("exploit.ser");

        serialize(vunerable, serFile);
        deserialize(serFile);

        assertThat(hackedFile).exists();
    }
}
